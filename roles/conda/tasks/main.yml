---
- name: Check if Anaconda is installed
  ansible.builtin.stat:
    path: /opt/anaconda3
  register: conda_result

- name: Install Anaconda
  when: not conda_result.stat.exists
  become: true
  block:
    - name: Download Anaconda installer
      ansible.builtin.get_url:
        url: https://repo.anaconda.com/archive/Anaconda3-2022.05-Linux-x86_64.sh
        dest: /tmp/anaconda3.sh
        mode: '0755'

    - name: Run Anaconda installer
      ansible.builtin.command:
        cmd: /tmp/anaconda3.sh -b -p /opt/anaconda3
        creates: /opt/anaconda3

- name: Ensure conda group exists
  ansible.builtin.group:
    name: conda
    state: present

- name: Ensure Anaconda folder is accessible to conda group
  ansible.builtin.file:
    path: /opt/anaconda3
    group: conda

- name: Add Anaconda to /etc/profile
  ansible.builtin.lineinfile:
    path: /etc/profile
    search_string: 'Generated by Ansible: adds Anaconda to $PATH'
    line: 'PATH=$PATH:$HOME/anaconda3/bin  # Generated by Ansible: adds Anaconda to $PATH'
